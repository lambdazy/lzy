syntax = "proto3";

import "ai/lzy/v1/zygote.proto";
import "google/protobuf/timestamp.proto";

package ai.lzy.v1;

option java_outer_classname = "LWBS";
option java_package = "ai.lzy.v1";

service LzyWhiteboardService {
  rpc Create (CreateRequest) returns (Whiteboard);
  rpc LinkField (LinkFieldRequest) returns (LinkFieldResponse);
  rpc Finalize (FinalizeRequest) returns (FinalizeResponse);

  rpc Get (GetRequest) returns (Whiteboard);
  rpc List (ListRequest) returns (ListResponse);
}

message Whiteboard {
  string id = 1;
  repeated WhiteboardField fields = 2;
  Storage storage = 3;
  Status status = 4;
  repeated string tags = 5;
  string namespace = 6;
  google.protobuf.Timestamp createdAt = 7;

  enum Status {
    WHITEBOARD_STATUS_UNSPECIFIED = 0;
    CREATED = 1;
    FINALIZED = 2;
  }
}

message WhiteboardField {
  string fieldName = 1;

  oneof state {
    CreatedField createdState = 2;
    LinkedField linkedState = 3;
  }

  message CreatedField {
  }

  message LinkedField {
    DataScheme scheme = 1;
    string storageUri = 2;
  }
}

message Storage {
  string name = 1;
  string description = 2;
}

message CreateRequest {
  repeated string fieldNames = 1;
  Storage storage = 2;
  repeated string tags = 3;
  string namespace = 4;
}

message LinkFieldRequest {
  string whiteboardId = 1;
  string fieldName = 2;
  string storageUri = 3;
  DataScheme scheme = 4;
}

message LinkFieldResponse {
}

message FinalizeRequest {
  string whiteboardId = 1;
}

message FinalizeResponse {
}

message GetRequest {
  string whiteboardId = 1;
}

message ListRequest {
  repeated string tags = 1;
  oneof query {
    DateTimeQuery dateTimeQuery = 2;
    //more query types
  }
}

message DateTimeQuery {
  google.protobuf.Timestamp from = 1;
  google.protobuf.Timestamp to = 2;
}

message ListResponse {
  repeated Whiteboard whiteboards = 1;
}


